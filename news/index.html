<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="The official website for Tweetalyze, by Adam Gincel and Kevin Quigley.">
    <meta name="author" content="Adam Gincel and Kevin Quigley">

    <title>Tweetalyze</title>

    <!-- Bootstrap Core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="css/landing-page.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic,700italic" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <style type="text/css">
    	.verticalCenter {
    		height: 100%;
    		display: inline-block;
    		vertical-align: middle;
    	}
    	.verticalCenterImg {
    		display: inline-block; vertical-align: middle;
    	}
    </style>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script> 
    <script src="http://malsup.github.com/jquery.form.js"></script>

    <!-- Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

</head>

<body>
<br><br><br><br>
    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-fixed-top topnav" role="navigation">
        <div class="container topnav">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <!--
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button> -->
                <h1><a href="http://tweetalyze.com/">Tweetalyze</a></h1>
                <p>Information on demand.</p>
            </div>
            
        </div>
        <!-- /.container -->
    </nav>

    <main>
        <h2>The Newsroom</h2>

        <form id="tweetForm">
            <label for="pw">Access key: </label>
            <input type="password" name="pw" id="pw" />
            <br />

            <label for="replies">Include replies?</label>
            <input type="checkbox" name="replies" id="replies" />
            <br />

            <label for="rts">Include retweets?</label>
            <input type="checkbox" name="rts" id="rts"/>
            <br />

            <label for="search">Count tweets including: </label>
            <input type="text" name="search" id="search"/>
            <br />

            <label>Minimum number of occurences to appear in Word Cloud: </label> <input id="wordCloudMinSize" type="number" min="1" max="10" value="5" style="width: 35px" />
            <br />

            <button type="submit" id="tweetSubmit">Submit</button>
            <br><br>
        </form>

        <label>Time Requested: </label><p id="currentDate"></p>

        <div id="ByUsername_p"><!-- Plotly chart will be drawn inside this DIV --></div>
        <br><br>
        <div id="ByFrequency"><!-- Plotly chart will be drawn inside this DIV --></div>
        <br><br>
        <div id="ByLength"><!-- Plotly chart will be drawn inside this DIV --></div>

        <div id="wordCloudDiv">
            <h2>Word Cloud</h2>
            <canvas id="wordCloud" width="1460" height="840" style="width: 65%; height: auto;"></canvas>
            <br />
            <button onclick="openImage()">Create Downloadable Image</button>

            <br /> <br />
            <img style="width: 95%; height: auto;" id="wordCloudImg" src="" alt="Right click or long-press to save!" />
        </div>
    </main>
    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <ul class="list-inline">
                        <li>
                            <a href="http://tweetalyze.com">Home</a>
                        </li>
                        <li class="footer-menu-divider">&sdot;</li>
                        <li>
                            <a href="https://adamgincel.com">Adam Gincel</a>
                        </li>
                        <li class="footer-menu-divider">&sdot;</li>
                        <li>
                            <a href="http://kevinquigley.net">Kevin Quigley</a>
                        </li>
                    </ul>
                    <p class="copyright text-muted small">Copyright &copy; Tweetalyze 2018. All Rights Reserved</p>
                </div>
            </div>
        </div>
    </footer>

    <script src="wordcloud2.js"></script>

</body>

</html>

<!--Analytics-->

<script>
    var plotly_UNs = [];
    var plotly_searchHits = [];
    var plotly_searchTerms = [];
    var plotly_frequencies = [];
    var plotly_samplesize = [];
    var plotly_searchPercent = [];
    var plotly_hoursBetween = [];
    var plotly_tweetLength = [];
    var plotly_uniqueWords = [];
    var news_user = "realDonaldTrump";
    var news_count = 0;

    function openImage() {
        let canvas = document.getElementById("wordCloud");
        let img = document.getElementById("wordCloudImg");
        img.src = canvas.toDataURL("image/png");
        window.scrollTo(0,document.body.scrollHeight);
    }

    $(document).ready(function() {
        $("#tweetForm").ajaxForm({
            
            url: 'http://tweetgettimestamps.herokuapp.com/?pw=' + $('#pw').val() + '&user=' + news_user + ($('#replies').is(":checked") ? '&replies=1' : '') + ($('#rts').is(":checked") ? '&rts=1' : '') + ($('#search').val() != "" ? "&search=" + $("#search").val() : "" ),
            type: 'get', 
            beforeSend: function() {
                $('#tweetSubmit').attr("disabled",true);
                $('#tweetSubmit').html("Loading");  
                $("#tweetResults").hide();
                $("#error").hide();
                console.log('http://tweetgettimestamps.herokuapp.com/?pw=' + $('#pw').val() + '&user=' + news_user + ($('#replies').is(":checked") ? '&replies=1' : '') + ($('#rts').is(":checked") ? '&rts=1' : '') + ($('#search').val() != "" ? "&search=" + $("#search").val() : "" ));
                $("#currentDate").html(new Date().toString());
            },
            success: function(responseText, statusText, xhr, $form) {
                console.log(responseText);
                $('#tweetSubmit').attr("disabled",false);
                $('#tweetSubmit').html("Submit");
                                
                if (responseText.name){
                    plotly_UNs.push(responseText.name);
                    plotly_searchHits.push(responseText.searchHits);
                    plotly_searchTerms.push($('#search').val());
                    plotly_frequencies.push(responseText.perDay.toFixed(2));
                    plotly_samplesize.push(responseText.sampleSize);
                    plotly_searchPercent.push(((responseText.searchHits / responseText.sampleSize)*100).toFixed(2));
                    plotly_hoursBetween.push((responseText.avgHoursBetween).toFixed(2));
                    plotly_tweetLength.push((responseText.avgTweetLength).toFixed(2));
                    plotly_uniqueWords.push(responseText.uniqueWords);
                }

                //Plotly JS goes here-------------------------------------------------------------------------- PLOTLY begin

                var data_p = [{ //-------------------------------Prevalence of Single Term by Multiple Users
                    x: plotly_UNs, 
                    y: plotly_searchPercent, 
                    type: 'bar',
                    text: plotly_searchPercent,
                    textposition: 'auto'
                    }];

                var layout_p = {
                    title: 'Prevalence of "' + $('#search').val() + '" in Tweets',
                    yaxis: {
                        title: '% of Sampled Tweets incl. "' + $('#search').val() + '"',
                        titlefont: {
                            size: 12,
                            color: 'rgb(107, 107, 107)'},
                            },
                    xaxis: {
                        title: 'Twitter Username',
                        titlefont: {
                            size: 12,
                            color: 'rgb(107, 107, 107)'},
                            }
                    };

                    Plotly.newPlot('ByUsername_p', data_p, layout_p);

                var data3 = [{ //-------------------------------------Frequencies by Username
                    x: plotly_UNs, 
                    y: plotly_frequencies, 
                    type: 'bar',
                    text: plotly_frequencies,
                    textposition: 'auto'
                    }];

                var layout3 = {
                    title: 'Tweet Frequency',
                    yaxis: {
                        title: 'Average Frequency (Tweets/Day)',
                        titlefont: {
                            size: 12,
                            color: 'rgb(107, 107, 107)'},
                            },
                    xaxis: {
                        title: 'Twitter Username',
                        titlefont: {
                            size: 12,
                            color: 'rgb(107, 107, 107)'},
                            }
                    };

                    Plotly.newPlot('ByFrequency', data3, layout3);

                var data4 = [{ //-------------------------------------Average Length by Username
                    x: plotly_UNs, 
                    y: plotly_tweetLength, 
                    type: 'bar',
                    text: plotly_tweetLength,
                    textposition: 'auto'
                    }];

                var layout4 = {
                    title: 'Tweet Length',
                    yaxis: {
                        title: 'Average Tweet Length (Characters)',
                        titlefont: {
                            size: 12,
                            color: 'rgb(107, 107, 107)'},
                            },
                    xaxis: {
                        title: 'Twitter Username',
                        titlefont: {
                            size: 12,
                            color: 'rgb(107, 107, 107)'},
                            }
                    };

                    Plotly.newPlot('ByLength', data4, layout4); //-----------------------------------------------end plotly 

                //---------------------------------------------------------------------------------------------WORD CLOUD BEGIN

                    let wordCloud = [];
                    let minCount = parseInt($("#wordCloudMinSize").val());
                    for (let i = 0; i < responseText.wordCloudList.length; i++) {
                        if (responseText.wordCloudList[i][1] >= minCount)
                            wordCloud.push(responseText.wordCloudList[i]);
                    }

                    let wordList = "<tr><td><strong>Word</strong></td><td><strong>Quantity</strong></td></tr>";
                    wordCloud.sort(function(a, b) {
                        return b[1] - a[1]
                    });
                    let max = parseInt(wordCloud[0][1]);
                    for (let i = 0; i < wordCloud.length; i++) {
                        wordList += "<tr><td>" + wordCloud[i][0] + "</td><td>" + wordCloud[i][1] + "</td></tr>";
                        wordCloud[i][1] = Math.ceil((wordCloud[i][1] * 100) / max);
                    }
                    
                    let canvas = document.getElementById("wordCloud");
                    WordCloud(canvas, {
                        list: wordCloud, 
                        gridSize: 10,
                        weightFactor: function (size) {
                            //return Math.pow(size, 2.3) * $('#wordCloud').width() / 1024;
                            return size * (wordCloud.length > 100 ? 1.4 : 2);
                        },
                        minFontSize: "30px"
                    });              

                    $("#wordCloudDiv").show(); //------------------------------------------------------------------------ end word cloud
            }
        });
        $("#tweetResults").hide();
        $("#error").hide();
        $("#wordCloudDiv").hide();
    });
</script>
    
  </html>