<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="The official website for Tweetalyze, by Adam Gincel and Kevin Quigley.">
    <meta name="author" content="Adam Gincel and Kevin Quigley">

    <title>Tweetalyze</title>

    <!-- Bootstrap Core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="css/landing-page.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic,700italic" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <style type="text/css">
    	.verticalCenter {
    		height: 100%;
    		display: inline-block;
    		vertical-align: middle;
    	}
    	.verticalCenterImg {
    		display: inline-block; vertical-align: middle;
    	}
    </style>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script> 
    <script src="/jquery.form.js"></script>

    <!-- Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

</head>

<body>
<br><br><br><br>
    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-fixed-top topnav" role="navigation">
        <div class="container topnav">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <!--
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button> -->
                <h1><a href="https://tweetalyze.com/">Tweetalyze</a></h1>
                <p>Information on demand.</p>
            </div>
            
        </div>
        <!-- /.container -->
    </nav>

    <main>
        <h2>Query Form</h2>
        <p>Enter a Twitter user's handle and a search term, and we'll query Twitter and give you some statistics!</p>
        <form id="tweetForm">
            <label for="pw">Access key: </label>
            <input type="password" name="pw" id="pw" />
            <br />

            <label for="user">Twitter handle: @</label>
            <input type="text" name="user" id="user" value="realDonaldTrump"/>
            <br />

            <label for="replies">Include replies?</label>
            <input type="checkbox" name="replies" id="replies" />
            <br />

            <label for="rts">Include retweets?</label>
            <input type="checkbox" name="rts" id="rts"/>
            <br />

            <label for="search">Count tweets including: </label>
            <input type="text" name="search" id="search"/>
            <br />

            <button type="submit" id="tweetSubmit">Submit</button>
            <br><br>
        </form>

        <form>
            <input type="radio" name="prefabs_or_build" value="prefabs" checked onclick="showPrefabs()"> Use Tweetalyze Graphs
            <input type="radio" name="prefabs_or_build" value="build" onclick="showBuild()"> Build Your Own Graph
        </form>
        <br>
        <section id="prefabs">
            <label>Display Raw Response Table?</label><input id="ui_RawResponseTable" type = "checkbox" /><br>
            <label>Plot Tweet Composition?</label><input id="ui_Sample_Composition" type = "checkbox" /><br>
            <label>Plot Retweet Prevalence?</label><input id="ui_Composition_RTs" type = "checkbox" /><br>
            <label>Plot Reply Prevalence?</label><input id="ui_Composition_replies" type = "checkbox" /><br>
            <label>Plot Retweet and Reply Prevalance?</label><input id="ui_Composition_RTs_replies" type = "checkbox" /><br>
            <label>Plot x: username, y: term prevalence?</label><input id="ui_SSTMU" type = "checkbox" /><br>
            <label>Plot x: username, y: 2 term prevalence?</label><input id="ui_SSTMU2" type = "checkbox" /><br>
            <label>Plot x: term, y: prevalence?</label><input id="ui_MSTSU" type = "checkbox" /><br>
            <label>Plot Tweet Frequency?</label><input id="ui_Frequencies" type = "checkbox" /><br>
            <label>Plot Tweet Length?</label><input id="ui_Lengths" type = "checkbox" /><br>
            <label>Plot Followers?</label><input id="ui_Followers" type = "checkbox" /><br>
            <label>Plot Following?</label><input id="ui_Following" type = "checkbox" /><br>
            <label>Plot Followers and Following?</label><input id="ui_Followers_and_Following" type = "checkbox" /><br>
            <label>Plot Likes?</label><input id="ui_Likes" type = "checkbox" /><br>
            <label>Plot Retweets?</label><input id="ui_Retweets" type = "checkbox" /><br>
            <label>Generate Word Cloud?</label><input id="ui_WordCloud" type = "checkbox" /><br>
            <label>Minimum number of occurences to appear in Word Cloud: </label> <input id="wordCloudMinSize" type="number" min="1" max="10" value="5" style="width: 35px" />
        </section>
        <section id="build">
            <label>Chart Type:</label>
                <input type="radio" name="build_chart_type" id="build_chart_type" value="bar" checked onclick="setBar()"> Bar
                <input type="radio" name="build_chart_type" id="build_chart_type" value="line" onclick="setLine()"> Line 
                <input type="radio" name="build_chart_type" id="build_chart_type" value="pie" onclick ="setPie()"> Pie<br>
            <label>X-Axis Data:</label>
                <input type="radio" name="build_chart_xaxis" id="build_chart_xaxis" value="username" checked onclick="setxUNs()"> Username
                <input type="radio" name="build_chart_xaxis" id="build_chart_xaxis" value="term" onclick="setxTerms()"> Searched Terms 
                <input type="radio" name="build_chart_xaxis" id="build_chart_xaxis" value="frequency" onclick ="setxFrequencies()"> Tweet Frequency
                <input type="radio" name="build_chart_xaxis" id="build_chart_xaxis" value="periodbetween" onclick="setxPeriod()"> Period Between Tweets
                <input type="radio" name="build_chart_xaxis" id="build_chart_xaxis" value="length" onclick="setxLength()"> Tweet Length 
                <input type="radio" name="build_chart_xaxis" id="build_chart_xaxis" value="uniquewords" onclick ="setxUniqueWords()"> Unique Words
                <input type="radio" name="build_chart_xaxis" id="build_chart_xaxis" value="followers" onclick="setxFollowers()"> Followers
                <input type="radio" name="build_chart_xaxis" id="build_chart_xaxis" value="followings" onclick="setxFollowings()"> Followings 
                <input type="radio" name="build_chart_xaxis" id="build_chart_xaxis" value="likes" onclick ="setxLikes()"> Likes
                <input type="radio" name="build_chart_xaxis" id="build_chart_xaxis" value="retweets" onclick ="setxRetweets()"> Retweets<br>
            <label>Y-Axis Data:</label>
                <input type="radio" name="build_chart_yaxis" id="build_chart_yaxis" value="prevalance" checked onclick="setyPrev()"> Term Prevalence 
                <input type="radio" name="build_chart_yaxis" id="build_chart_yaxis" value="frequency" onclick ="setyFrequencies()"> Tweet Frequency
                <input type="radio" name="build_chart_yaxis" id="build_chart_yaxis" value="periodbetween" onclick="setyPeriod()"> Period Between Tweets
                <input type="radio" name="build_chart_yaxis" id="build_chart_yaxis" value="length" onclick="setyLength()"> Tweet Length 
                <input type="radio" name="build_chart_yaxis" id="build_chart_yaxis" value="uniquewords" onclick ="setyUniqueWords()"> Unique Words
                <input type="radio" name="build_chart_yaxis" id="build_chart_yaxis" value="followers" onclick="setyFollowers()"> Followers
                <input type="radio" name="build_chart_yaxis" id="build_chart_yaxis" value="followings" onclick="setyFollowings()"> Followings 
                <input type="radio" name="build_chart_yaxis" id="build_chart_yaxis" value="likes" onclick ="setyLikes()"> Likes
                <input type="radio" name="build_chart_yaxis" id="build_chart_yaxis" value="retweets" onclick ="setyRetweets()"> Retweets<br>
            <label>Chart Title:</label>
                <input type="text" name="build_chart_title_text" id="build_chart_title_text" value=""/>
                <input type="color" name="build_chart_title_color" id="build_chart_title_color" value="#000000"/> <br>
            <label>X-Axis Label:</label>
                <input type="text" name="build_chart_xaxis_text" id="build_chart_xaxis_text" value=""/>
                <input type="color" name="build_chart_xaxis_color" id="build_chart_xaxis_color" value="#7f7f7f"/><br>
            <label>Y-Axis Label:</label>
                <input type="text" name="build_chart_yaxis_text" id="build_chart_yaxis_text" value=""/>
                <input type="color" name="build_chart_yaxis_color" id="build_chart_yaxis_color" value="#7f7f7f"/><br>
            <label>Display Y-Axis Value?</label><input id="build_chart_yaxis_display" type = "checkbox" /><br>
            <form id="build_bar_aesthetic">
                <label>Opacity:</label><input type="number" name="build_chart_bar_opacity" id="build_chart_bar_opacity" min="0" max="1" value="1"/>
                <label>Fill Color:</label><input type="color" name="build_chart_bar_fillcolor" id="build_chart_bar_fillcolor" value="#1F77B4"/>
                <label>Outline Color:</label><input type="color" name="build_chart_bar_outlinecolor" id="build_chart_bar_outlinecolor" value="#000000"/>
                <label>Outline Width:</label><input type="number" name="build_chart_bar_outlinewidth" id="build_chart_bar_outlinewidth" min="0" max="10" value="0"/>
            </form>
            <div id="build_line_aesthetic">
                <label>Line Mode:</label>
                    <input type="radio" name="build_chart_linemode" id="build_chart_linemode" value="lines+markers" checked onclick="setLineModeBoth()"> Lines and Markers
                    <input type="radio" name="build_chart_linemode" id="build_chart_linemode" value="lines" onclick="setLineModeLines()"> Lines 
                    <input type="radio" name="build_chart_linemode" id="build_chart_linemode" value="markers" onclick ="setLineModeMarkers()"> Markers<br>
                <div id="build_line_line">
                        <label>Line Width:</label><input type="number" name="build_chart_line_linewidth" id="build_chart_line_linewidth" min="1" max="10" value="2"/>
                        <label>Line Color:</label><input type="color" name="build_chart_line_linecolor" id="build_chart_line_linecolor" value="#1F77B4"/>
                </div>
                <div id="build_line_marker">
                    <label>Marker Size:</label></label><input type="number" name="build_chart_line_marker_size" id="build_chart_line_marker_size" min="1" max="24" value="12"/>
                    <label>Marker Color:</label><input type="color" name="build_chart_line_marker_color" id="build_chart_line_marker_color" value="#1F77B4"/>
                </div>
            </div>
            <form id="build_pie_aesthetic">
                
            </form>
            <br><br>
            <button onclick="generate_plot()">Generate Plot</button>
        </section>
        <br><br>

        <section id="error"><h1 id="errorDesc"></h1></section>

        <table id="resultsTable">
            <tr style="border: 1px solid gray">
                <td>Timestamp</td>
                <td>Username</td>
                <td>Inc. Replies?</td>
                <td>Inc. RTs?</td>
                <td>Search Term</td>
                <td>Sample Size</td>
                <!--<td>Avg Tweets Per Day</td>-->
                <!-- <td>Avg Hours Between Tweets</td> -->
                <!--<td>Tweets Including Search Term</td>-->
            </tr>
        </table>
        <br><br>
        <button onclick="download_csv()">Download Results CSV</button> 
        <br><br>
        <!--<label>Time Requested: </label><p id="currentDate"></p>-->

        <div id="UserGeneratedPlot"><!-- Plotly chart will be drawn inside this DIV --></div>
        <br><br>
        <div id="ResponseTable"><!-- Plotly chart will be drawn inside this DIV --></div>
        <br><br>
        <div id="SampleComposition"><!-- Plotly chart will be drawn inside this DIV --></div>
        <br><br>
        <div id="Composition_RTs"><!-- Plotly chart will be drawn inside this DIV --></div>
        <br><br>
        <div id="Composition_replies"><!-- Plotly chart will be drawn inside this DIV --></div>
        <br><br>
        <div id="Composition_RTs_replies"><!-- Plotly chart will be drawn inside this DIV --></div>
        <br><br>
        <div id="ByUsername_p"><!-- Plotly chart will be drawn inside this DIV --></div>
        <br><br>
        <div id="ByUsername_p2"><!-- Plotly chart will be drawn inside this DIV --></div>
        <br><br>
        <div id="BySearch_p"><!-- Plotly chart will be drawn inside this DIV --></div>
        <br><br>
        <div id="ByFrequency"><!-- Plotly chart will be drawn inside this DIV --></div>
        <br><br>
        <div id="ByLength"><!-- Plotly chart will be drawn inside this DIV --></div>
        <br><br>
        <div id="ByFollowers"><!-- Plotly chart will be drawn inside this DIV --></div>
        <br><br>
        <div id="ByFollowing"><!-- Plotly chart will be drawn inside this DIV --></div>
        <br><br>
        <div id="ByFollowersAndFollowing"><!-- Plotly chart will be drawn inside this DIV --></div>
        <br><br>
        <div id="ByLikes"><!-- Plotly chart will be drawn inside this DIV --></div>
        <br><br>
        <div id="ByRetweets"><!-- Plotly chart will be drawn inside this DIV --></div>

        <div id="wordCloudDiv">
            <h2>Word Cloud</h2>
            <canvas id="wordCloud" width="1460" height="840" style="width: 65%; height: auto;"></canvas>
            <br />
            <button onclick="openImage()">Create Downloadable Image</button>
            <h3>Word List</h3>
            <table id="wordList">

            </table>
            <br /> <br />
            <img style="width: 95%; height: auto;" id="wordCloudImg" src="" alt="Right click or long-press to save!" />
        </div>
    </main>
    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <ul class="list-inline">
                        <li>
                            <a href="https://tweetalyze.com">Home</a>
                        </li>
                        <li class="footer-menu-divider">&sdot;</li>
                        <li>
                            <a href="https://adamgincel.com">Adam Gincel</a>
                        </li>
                        <li class="footer-menu-divider">&sdot;</li>
                        <li>
                            <a href="https://kevinquigley.net">Kevin Quigley</a>
                        </li>
                    </ul>
                    <p class="copyright text-muted small">Copyright &copy; Tweetalyze 2018. All Rights Reserved</p>
                </div>
            </div>
        </div>
    </footer>

    <script src="wordcloud2.js"></script>

</body>

</html>

<!--Analytics-->

<script>
    let csvString = "Timestamp,Username,Include Replies?,Include Retweets?,Search Term,Sample Size,Number of Retweets,Percent Retweets,Number of Replies,Percent Replies,Time Since Last Tweet (Days),Average Frequency (Tweets/Day),Average Period Between Tweets (Hours),Average Tweet Length (Characters),Unique Words,Tweets Including Search Term,Followers,Following,Average Tweet Likes,Average Tweet Retweets,Tweet Clients\n";
    var plotly_timestamp = [];
    var plotly_UNs = [];
    var plotly_replies = [];
    var plotly_rts = [];
    var plotly_searchHits = [];
    var plotly_searchTerms = [];
    var plotly_frequencies = [];
    var plotly_samplesize = [];
    var plotly_searchPercent = [];
    var plotly_hoursBetween = [];
    var plotly_tweetLength = [];
    var plotly_uniqueWords = [];
    var plotly_followers = [];
    var plotly_followings = [];
    var plotly_avg_retweets = [];
    var plotly_avg_likes = [];
    var plotly_tweet_clients = [];
    var plotly_num_RTs = [];
    var plotly_perc_RTs = [];
    var plotly_num_replies = [];
    var plotly_perc_replies = [];
    var plotly_daysSince = [];

    function openImage() {
        let canvas = document.getElementById("wordCloud");
        let img = document.getElementById("wordCloudImg");
        img.src = canvas.toDataURL("image/png");
        window.scrollTo(0,document.body.scrollHeight);
    }

    //control which graph options display to the user
    $('#build').hide(); //hide on page load
    function showPrefabs() {
        $('#build').hide();
        $('#prefabs').show();
    }

    function showBuild(){
        $('#prefabs').hide();
        $('#build').show();
    }

    $(document).ready(function() {
        $("#tweetForm").ajaxForm({
            //url: 'http://tweetgettimestamps.herokuapp.com/?' + $('#tweetForm').serialize(),
            url: 'https://tweetgettimestamps.herokuapp.com/?pw=' + $('#pw').val() + '&user=' + $('#user').val() + ($('#replies').is(":checked") ? '&replies=1' : '') + ($('#rts').is(":checked") ? '&rts=1' : '') + ($('#search').val() != "" ? "&search=" + $("#search").val() : "" ),
            type: 'get', 
            beforeSend: function() {
                $('#tweetSubmit').attr("disabled",true);
                $('#tweetSubmit').html("Loading");  
                $("#tweetResults").hide();
                $("#error").hide();
                console.log('https://tweetgettimestamps.herokuapp.com/?pw=' + $('#pw').val() + '&user=' + $('#user').val() + ($('#replies').is(":checked") ? '&replies=1' : '') + ($('#rts').is(":checked") ? '&rts=1' : '') + ($('#search').val() != "" ? "&search=" + $("#search").val() : "" ));
                $("#currentDate").html(new Date().toString());
            },
            success: function(responseText, statusText, xhr, $form) {
                console.log(responseText);
                $('#tweetSubmit').attr("disabled",false);
                $('#tweetSubmit').html("Submit");
                                
                let row = "<tr>";
                if (responseText.name){
                    row += "<td>" + Date(Date.now()) + "</td>";
                    row += "<td>" + responseText.name + "</td>";   //$("#userSpan").html("@" + responseText.name);
                    row += "<td>" + $('#replies').is(":checked") + "</td>";
                    row += "<td>" + $('#rts').is(":checked") + "</td>";
                    
                    let client_clean = "";
                    for (let i = 0; i < responseText.tweet_clients.length; i++){
                        client_clean += responseText.tweet_clients[i] + ";";
                    }

                    csvString += Date(Date.now()) + "," + responseText.name + "," + $('#replies').is(":checked") + "," + $('#rts').is(":checked") + "," + $('#search').val().toLowerCase() + "," + responseText.sampleSize + "," + responseText.num_RTs + "," + responseText.perc_RTs + "," + responseText.num_replies + "," + responseText.perc_replies + "," + responseText.daysSince + "," + responseText.perDay + "," + responseText.avgHoursBetween + "," + responseText.avgTweetLength + "," + responseText.uniqueWords + "," + responseText.searchHits + "," + responseText.followers + ","+ responseText.followings + "," + responseText.avg_likes + "," + responseText.avg_retweets + "," + responseText.tweet_clients + "\n";

                    plotly_timestamp.push(Date(Date.now()));
                    plotly_UNs.push(responseText.name);
                    plotly_replies.push($('#replies').is(":checked"));
                    plotly_rts.push($('#rts').is(":checked"));
                    plotly_searchHits.push(responseText.searchHits);
                    plotly_searchTerms.push($('#search').val().toLowerCase());
                    plotly_frequencies.push(responseText.perDay.toFixed(2));
                    plotly_samplesize.push(responseText.sampleSize);
                    plotly_searchPercent.push(((responseText.searchHits / responseText.sampleSize)*100).toFixed(2));
                    plotly_hoursBetween.push((responseText.avgHoursBetween).toFixed(2));
                    plotly_tweetLength.push((responseText.avgTweetLength).toFixed(2));
                    plotly_uniqueWords.push(responseText.uniqueWords);
                    plotly_followers.push(responseText.followers);
                    plotly_followings.push(responseText.followings);
                    plotly_avg_retweets.push((responseText.avg_retweets).toFixed(2));
                    plotly_avg_likes.push((responseText.avg_likes).toFixed(2));
                    plotly_tweet_clients.push(client_clean);
                    plotly_num_RTs.push(responseText.num_RTs);
                    plotly_perc_RTs.push((responseText.perc_RTs).toFixed(2));
                    plotly_num_replies.push(responseText.num_replies);
                    plotly_perc_replies.push((responseText.perc_replies).toFixed(2));
                    plotly_daysSince.push((responseText.daysSince).toFixed(2));
                }
                else
                    row += "<td>Name Not Found</td>";//$("#userSpan").html("Name Not Found");

                row += "<td>" + $('#search').val().toLowerCase() + "</td>";
                console.log($("#search").val());
                
                if (responseText.sampleSize)
                    row += "<td>" + responseText.sampleSize.toString() + "</td>"; //$("#sampleSize").html(responseText.sampleSize);
                else
                    row += "<td>0</td>"; //$("#sampleSize").html("0");

                /*if (responseText.perDay)
                {
                    row += "<td>" + responseText.perDay.toFixed(4).toString() + "</td>"; //$("#perDay").html(responseText.perDay.toFixed(4));
                }
                else 
                    row += "<td>0</td>"; //$("#perDay").html("0");*/

                /*if (responseText.avgHoursBetween)
                    row += "<td>" + responseText.avgHoursBetween.toFixed(4).toString() + "</td>"; //$("#averageHoursBetween").html(responseText.avgHoursBetween.toFixed(4));
                else
                    row += "<td>0</td>"; //$("#averageHoursBetween").html("0");*/

                /*if (responseText.daysSince)
                    $("#daysSince").html(responseText.daysSince.toFixed(4));
                else
                    $("#daysSince").html("0");

                if (responseText.searchHits !== undefined) {
                    $("#searchHits").html(responseText.searchHits);
                    $("#searchPhrase").html($("#search").val());
                    $("#searchHitsLabel").show();
                } else {
                    $("#searchHitsLabel").hide();
                }*/
                /*if (responseText.searchHits) {
                    row += "<td>" + responseText.searchHits.toString() + "</td>";
                } else {
                    row += "<td>0</td>";
                }*/

                row += "</tr>";
                
                /*let timeList = "";
                for (var i = 0; responseText.dates && i < responseText.dates.length; i++) {
                    timeList += "<li>" + responseText.dates[i].substring(0, 10) + " " + responseText.dates[i].substring(11, 19) + "</li>";
                }
                $("#timestamps").html(timeList);*/

                if (responseText.error) {
                    console.log("We found an error");
                    $("#errorDesc").html(responseText.error);
                    if (Array.isArray(responseText.error))
                        $("#errorDesc").html(responseText.error[0].message);
                    $("#error").show();
                } else {
                    //$("#tweetResults").show();
                    document.getElementById("resultsTable").innerHTML = document.getElementById("resultsTable").innerHTML + row;
                }

                //Plotly JS goes here-------------------------------------------------------------------------- PLOTLY prefabs begin

                var values = [ //-------------------------------------------------------Raw Response Table
                        plotly_timestamp,
                        plotly_UNs,
                        plotly_replies,
                        plotly_rts,
                        plotly_searchTerms,
                        plotly_samplesize,
                        plotly_num_RTs,
                        plotly_perc_RTs,
                        plotly_num_replies,
                        plotly_perc_replies,
                        plotly_daysSince,
                        plotly_frequencies,
                        plotly_hoursBetween,
                        plotly_tweetLength,
                        plotly_uniqueWords,
                        plotly_searchHits,
                        plotly_followers,
                        plotly_followings,
                        plotly_avg_likes,
                        plotly_avg_retweets]

                    var data = [{
                    type: 'table',
                    header: {
                        values: [["Timestamp"], ["Username"], ["Include Replies?"], ["Include Retweets?"], ["Search Term"],
                                    ["Sample Size"], ["# Retweets"], ["% Retweets"], ["# Replies"], ["% Replies"], ["Time Since Last Tweet (Days)"],["Average Frequency (Tweets/Day)"], ["Average Period Between Tweets (Hours)"], 
                                    ["Average Tweet Length (Characters)"], ["Unique Words"], ["Tweets Including Search Term"],["Followers"], ["Following"], 
                                    ["Average Tweet Likes"], ["Average Tweet Retweets"]],
                        align: "center",
                        line: {width: 1, color: 'black'},
                        fill: {color: 'rgb(0, 128, 255)'},
                        font: {family: "Arial", size: 12, color: "white"}
                    },
                    cells: {
                        values: values,
                        align: "center",
                        line: {color: "black", width: 1},
                        font: {family: "Arial", size: 11, color: ["black"]}
                    }
                    }]

                if($('#ui_RawResponseTable:checked').val()){
                    Plotly.plot('ResponseTable', data);}

                var data_sc = [{ //------------------------------------------------Sample Composition Pie Chart
                    values: [responseText.num_RTs,responseText.num_replies,responseText.sampleSize - responseText.num_RTs - responseText.num_replies], 
                    labels: ["Retweets", "Replies", "Other"], 
                    type: 'pie',
                    text: [responseText.num_RTs,responseText.num_replies,responseText.sampleSize - responseText.num_RTs - responseText.num_replies],
                    textposition: 'auto'
                    }];

                var layout_sc = {
                    title: 'Composition of @' + $('#user').val() + "'s Tweets",
                    };  

                if($('#ui_Sample_Composition:checked').val()){
                    Plotly.newPlot('SampleComposition', data_sc, layout_sc);}               

                var data_perc_RTs = [{ //-------------------------------Percent of Tweets that are Retweets
                    x: plotly_UNs, 
                    y: plotly_perc_RTs, 
                    type: 'bar',
                    text: plotly_perc_RTs,
                    textposition: 'auto'
                    }];

                var layout_perc_RTs = {
                    title: 'Prevalence of Retweets in Tweet Composition',
                    yaxis: {
                        title: 'Percent Retweets',
                        titlefont: {
                            size: 12,
                            color: 'rgb(107, 107, 107)'},
                            },
                    xaxis: {
                        title: 'Twitter Username',
                        titlefont: {
                            size: 12,
                            color: 'rgb(107, 107, 107)'},
                            }
                    };

                if($('#ui_Composition_RTs:checked').val()){
                    Plotly.newPlot('Composition_RTs', data_perc_RTs, layout_perc_RTs);} 

                var data_perc_replies = [{ //-------------------------------Percent of Tweets that are replies
                    x: plotly_UNs, 
                    y: plotly_perc_replies, 
                    type: 'bar',
                    text: plotly_perc_replies,
                    textposition: 'auto'
                    }];

                var layout_perc_replies = {
                    title: 'Prevalence of Replies in Tweet Composition',
                    yaxis: {
                        title: 'Percent Replies',
                        titlefont: {
                            size: 12,
                            color: 'rgb(107, 107, 107)'},
                            },
                    xaxis: {
                        title: 'Twitter Username',
                        titlefont: {
                            size: 12,
                            color: 'rgb(107, 107, 107)'},
                            }
                    };

                if($('#ui_Composition_replies:checked').val()){
                    Plotly.newPlot('Composition_replies', data_perc_replies, layout_perc_replies);} 
                
                var trace7_RTs_replies1 = { // ----------------------------------------------- retweets vs replies
                    x: plotly_UNs,
                    y: plotly_perc_RTs,
                    name: "Retweets",
                    text: plotly_perc_RTs,
                    textposition: 'auto',
                    type: 'bar'
                    };

                    var trace7_RTs_replies2 = {
                    x: plotly_UNs,
                    y: plotly_perc_replies,
                    name: "Replies",
                    text: plotly_perc_replies,
                    textposition: 'auto',
                    type: 'bar'
                    };

                    var data_RTs_replies = [trace7_RTs_replies1, trace7_RTs_replies2];

                    var layout7_RTs_replies = {barmode: 'group',
                        title: 'Prevalence of Retweets vs. Replies in Tweet Composition',
                        yaxis: {
                            title: 'Percent',
                            titlefont: {
                                size: 12,
                                color: 'rgb(107, 107, 107)'},
                                },
                        xaxis: {
                            title: 'Twitter Username',
                            titlefont: {
                                size: 12,
                                color: 'rgb(107, 107, 107)'},
                                }
                    };
                if($('#ui_Composition_RTs_replies:checked').val()){
                    Plotly.newPlot('Composition_RTs_replies', data_RTs_replies, layout7_RTs_replies);}
                
                var data_p = [{ //-------------------------------Prevalence of Single Term by Multiple Users
                    x: plotly_UNs, 
                    y: plotly_searchPercent, 
                    type: 'bar',
                    text: plotly_searchPercent,
                    textposition: 'auto'
                    }];

                var layout_p = {
                    title: 'Prevalence of "' + $('#search').val() + '" in Tweets',
                    yaxis: {
                        title: '% of Sampled Tweets incl. "' + $('#search').val() + '"',
                        titlefont: {
                            size: 12,
                            color: 'rgb(107, 107, 107)'},
                            },
                    xaxis: {
                        title: 'Twitter Username',
                        titlefont: {
                            size: 12,
                            color: 'rgb(107, 107, 107)'},
                            }
                    };

                if($('#ui_SSTMU:checked').val()){
                    Plotly.newPlot('ByUsername_p', data_p, layout_p);} 

                var arrayLength = plotly_UNs.length; // ----------------- prevalance of two terms for multiple users
                var plotx = [];
                var y1 = [];
                var y2 = [];
                var name1 = "";
                var name2 = "";
                for (var i = 0; i < arrayLength; i++) {
                    if(i%2==0){
                        y1.push(plotly_searchPercent[i]);
                        name1 = plotly_searchTerms[i];
                        plotx.push(plotly_UNs[i]);
                    }
                    else{
                        y2.push(plotly_searchPercent[i]);
                        name2 = plotly_searchTerms[i];
                    }
                }
                var trace1_p2 = { 
                    x: plotx,
                    y: y1,
                    name: name1,
                    text: y1,
                    textposition: 'auto',
                    type: 'bar'
                    };

                    var trace2_p2 = {
                    x: plotx,
                    y: y2,
                    name: name2,
                    text: y2,
                    textposition: 'auto',
                    type: 'bar'
                    };

                    var data_p2 = [trace1_p2, trace2_p2];

                    var layout_p2 = {barmode: 'group',
                        title: 'Prevalence of Searched Terms in Tweets',
                        yaxis: {
                            title: '% of Sampled Tweets incl. Term',
                            titlefont: {
                                size: 12,
                                color: 'rgb(107, 107, 107)'},
                                },
                        xaxis: {
                            title: 'Twitter Username',
                            titlefont: {
                                size: 12,
                                color: 'rgb(107, 107, 107)'},
                                }
                    };
                if($('#ui_SSTMU2:checked').val()){
                    Plotly.newPlot('ByUsername_p2', data_p2, layout_p2);}

                var data2_p = [{ //-------------------------------Prevalence of Multiple Terms for Single user
                    x: plotly_searchTerms,
                    y: plotly_searchPercent, 
                    type: 'bar',
                    text: plotly_searchPercent,
                    textposition: 'auto'
                    }];

                var layout2_p = {
                    title: 'Prevalence of Searched Terms in Tweets by @' + $('#user').val(),
                    yaxis: {
                        title: '% of Sampled Tweets incl. Term',
                        titlefont: {
                            size: 12,
                            color: 'rgb(107, 107, 107)'},
                            },
                    xaxis: {
                        title: 'Terms',
                        titlefont: {
                            size: 12,
                            color: 'rgb(107, 107, 107)'},
                            }
                    };

                if($('#ui_MSTSU:checked').val()){
                    Plotly.newPlot('BySearch_p', data2_p, layout2_p);} 

                var data3 = [{ //-------------------------------------Frequencies by Username
                    x: plotly_UNs, 
                    y: plotly_frequencies, 
                    type: 'bar',
                    text: plotly_frequencies,
                    textposition: 'auto'
                    }];

                var layout3 = {
                    title: 'Tweet Frequency',
                    yaxis: {
                        title: 'Average Frequency (Tweets/Day)',
                        titlefont: {
                            size: 12,
                            color: 'rgb(107, 107, 107)'},
                            },
                    xaxis: {
                        title: 'Twitter Username',
                        titlefont: {
                            size: 12,
                            color: 'rgb(107, 107, 107)'},
                            }
                    };

                if($('#ui_Frequencies:checked').val()){
                    Plotly.newPlot('ByFrequency', data3, layout3);} 

                var data4 = [{ //-------------------------------------Average Length by Username
                    x: plotly_UNs, 
                    y: plotly_tweetLength, 
                    type: 'bar',
                    text: plotly_tweetLength,
                    textposition: 'auto'
                    }];

                var layout4 = {
                    title: 'Tweet Length',
                    yaxis: {
                        title: 'Average Tweet Length (Characters)',
                        titlefont: {
                            size: 12,
                            color: 'rgb(107, 107, 107)'},
                            },
                    xaxis: {
                        title: 'Twitter Username',
                        titlefont: {
                            size: 12,
                            color: 'rgb(107, 107, 107)'},
                            }
                    };

                if($('#ui_Lengths:checked').val()){
                    Plotly.newPlot('ByLength', data4, layout4);} 

                var data5 = [{ //-------------------------------------Followers by Username
                x: plotly_UNs, 
                y: plotly_followers, 
                type: 'bar',
                text: plotly_followers,
                textposition: 'auto'
                }];

                var layout5 = {
                    title: 'Twitter Followers',
                    yaxis: {
                        title: 'Followers (# of Users)',
                        titlefont: {
                            size: 12,
                            color: 'rgb(107, 107, 107)'},
                            },
                    xaxis: {
                        title: 'Twitter Username',
                        titlefont: {
                            size: 12,
                            color: 'rgb(107, 107, 107)'},
                            }
                    };

                if($('#ui_Followers:checked').val()){
                    Plotly.newPlot('ByFollowers', data5, layout5);}

                var data6 = [{ //-------------------------------------Followings by Username
                x: plotly_UNs, 
                y: plotly_followings, 
                type: 'bar',
                text: plotly_followings,
                textposition: 'auto'
                }];

                var layout6 = {
                    title: 'Twitter Friends (Following)',
                    yaxis: {
                        title: 'Following (# of Users)',
                        titlefont: {
                            size: 12,
                            color: 'rgb(107, 107, 107)'},
                            },
                    xaxis: {
                        title: 'Twitter Username',
                        titlefont: {
                            size: 12,
                            color: 'rgb(107, 107, 107)'},
                            }
                    };

                if($('#ui_Following:checked').val()){
                    Plotly.newPlot('ByFollowing', data6, layout6);}

                           
                var trace7_p1 = { // ----------------- followers vs followings
                    x: plotly_UNs,
                    y: plotly_followers,
                    name: "Followers",
                    text: plotly_followers,
                    textposition: 'auto',
                    type: 'bar'
                    };

                    var trace7_p2 = {
                    x: plotly_UNs,
                    y: plotly_followings,
                    name: "Friends (Following)",
                    text: plotly_followings,
                    textposition: 'auto',
                    type: 'bar'
                    };

                    var data7 = [trace7_p1, trace7_p2];

                    var layout7 = {barmode: 'group',
                        title: 'Twitter Followers vs. Friends (Following)',
                        yaxis: {
                            title: '# of Users',
                            titlefont: {
                                size: 12,
                                color: 'rgb(107, 107, 107)'},
                                },
                        xaxis: {
                            title: 'Twitter Username',
                            titlefont: {
                                size: 12,
                                color: 'rgb(107, 107, 107)'},
                                }
                    };
                if($('#ui_Followers_and_Following:checked').val()){
                    Plotly.newPlot('ByFollowersAndFollowing', data7, layout7);}

                var data8 = [{ //-------------------------------------Likes by Username
                x: plotly_UNs, 
                y: plotly_avg_likes, 
                type: 'bar',
                text: plotly_avg_likes,
                textposition: 'auto'
                }];

                var layout8 = {
                    title: 'Tweet Likes',
                    yaxis: {
                        title: 'Average Tweet Likes (Likes/Tweet)',
                        titlefont: {
                            size: 12,
                            color: 'rgb(107, 107, 107)'},
                            },
                    xaxis: {
                        title: 'Twitter Username',
                        titlefont: {
                            size: 12,
                            color: 'rgb(107, 107, 107)'},
                            }
                    };

                if($('#ui_Likes:checked').val()){
                    Plotly.newPlot('ByLikes', data8, layout8);}
                
                var data9 = [{ //-------------------------------------Retweets by Username
                x: plotly_UNs, 
                y: plotly_avg_retweets, 
                type: 'bar',
                text: plotly_avg_retweets,
                textposition: 'auto'
                }];

                var layout9 = {
                    title: 'Tweet Retweets',
                    yaxis: {
                        title: 'Average Tweet Retweets (Retweets/Tweet)',
                        titlefont: {
                            size: 12,
                            color: 'rgb(107, 107, 107)'},
                            },
                    xaxis: {
                        title: 'Twitter Username',
                        titlefont: {
                            size: 12,
                            color: 'rgb(107, 107, 107)'},
                            }
                    };

                if($('#ui_Retweets:checked').val()){
                    Plotly.newPlot('ByRetweets', data9, layout9);}
                    
                    //----------------------------------------------------------------------------------------------------end plotly 

                //---------------------------------------------------------------------------------------------WORD CLOUD BEGIN
                if($('#ui_WordCloud:checked').val()){
                    let wordCloud = [];
                    let minCount = parseInt($("#wordCloudMinSize").val());
                    for (let i = 0; i < responseText.wordCloudList.length; i++) {
                        if (responseText.wordCloudList[i][1] >= minCount)
                            wordCloud.push(responseText.wordCloudList[i]);
                    }

                    let wordList = "<tr><td><strong>Word</strong></td><td><strong>Quantity</strong></td></tr>";
                    wordCloud.sort(function(a, b) {
                        return b[1] - a[1]
                    });
                    let max = parseInt(wordCloud[0][1]);
                    for (let i = 0; i < wordCloud.length; i++) {
                        wordList += "<tr><td>" + wordCloud[i][0] + "</td><td>" + wordCloud[i][1] + "</td></tr>";
                        wordCloud[i][1] = Math.ceil((wordCloud[i][1] * 100) / max);
                    }
                    document.getElementById("wordList").innerHTML = wordList;
                    let canvas = document.getElementById("wordCloud");
                    WordCloud(canvas, {
                        list: wordCloud, 
                        gridSize: 10,
                        weightFactor: function (size) {
                            //return Math.pow(size, 2.3) * $('#wordCloud').width() / 1024;
                            return size * (wordCloud.length > 100 ? 1.4 : 2);
                        },
                        minFontSize: "30px"
                    });              

                    $("#wordCloudDiv").show();} //------------------------------------------------------------------------ end word cloud 
            }
        });
        $("#tweetResults").hide();
        $("#error").hide();
        $("#wordCloudDiv").hide();
    });

    function download_csv() { // ---------------------------------------------------------------------------------CSV download
        console.log(csvString);
        var hiddenElement = document.createElement('a');
        hiddenElement.href = 'data:text/csv;charset=utf-8,' + encodeURI(csvString);
        hiddenElement.target = '_blank';
        hiddenElement.download = 'tweetalyze-raw.csv';
        hiddenElement.click();
    }

    // ---------------------------------------------------------------------------------------------------------User generated plot prep
    $('#UserGeneratedPlot').hide();
    $('#build_line_aesthetic').hide();
    $('#build_pie_aesthetic').hide();
    $('#build_line_marker').show();
    $('#build_line_line').show();

    let build_chart_type = "bar";
    let build_chart_linemode = "lines+markers";
    function setBar() {
        build_chart_type = "bar";
        $('#build_line_aesthetic').hide();
        $('#build_pie_aesthetic').hide();
        $('#build_bar_aesthetic').show();
    }
    function setLine() {
        build_chart_type = "line";
        $('#build_bar_aesthetic').hide();
        $('#build_pie_aesthetic').hide();
        $('#build_line_aesthetic').show();
    }
    function setPie() {
        build_chart_type = "pie";
        $('#build_line_aesthetic').hide();
        $('#build_bar_aesthetic').hide();
        $('#build_pie_aesthetic').show();
    }
    function setLineModeBoth(){
        build_chart_linemode = "lines+markers";
        $('#build_line_marker').show();
        $('#build_line_line').show();
    }
    function setLineModeLines(){
        build_chart_linemode = "lines";
        $('#build_line_marker').hide();
        $('#build_line_line').show();
    }
    function setLineModeMarkers(){
        build_chart_linemode = "markers";
        $('#build_line_line').hide();
        $('#build_line_marker').show();
    }

    let build_chart_xaxis = plotly_UNs;
    function setxUNs(){
        build_chart_xaxis = plotly_UNs;
    }
    function setxTerms(){
        build_chart_xaxis = plotly_searchTerms;
    }
    function setxFrequencies(){
        build_chart_xaxis = plotly_frequencies;
    }
    function setxPeriod(){
        build_chart_xaxis = plotly_hoursBetween;
    }
    function setxLength(){
        build_chart_xaxis = plotly_tweetLength;
    }
    function setxUniqueWords(){
        build_chart_xaxis = plotly_uniqueWords;
    }
    function setxFollowers(){
        build_chart_xaxis = plotly_followers;
    }
    function setxFollowings(){
        build_chart_xaxis = plotly_followings;
    }
    function setxLikes(){
        build_chart_xaxis = plotly_avg_likes;
    }
    function setxRetweets(){
        build_chart_xaxis = plotly_avg_retweets;
    }
    let build_chart_yaxis = plotly_searchPercent;
    function setyPrev(){
        build_chart_yaxis = plotly_searchPercent;
    }
    function setyFrequencies(){
        build_chart_yaxis = plotly_frequencies;
    }
    function setyPeriod(){
        build_chart_yaxis = plotly_hoursBetween;
    }
    function setyLength(){
        build_chart_yaxis = plotly_tweetLength;
    }
    function setyUniqueWords(){
        build_chart_yaxis = plotly_uniqueWords;
    }
    function setyFollowers(){
        build_chart_yaxis = plotly_followers;
    }
    function setyFollowings(){
        build_chart_yaxis = plotly_followings;
    }
    function setyLikes(){
        build_chart_yaxis = plotly_avg_likes;
    }
    function setyRetweets(){
        build_chart_yaxis = plotly_avg_retweets;
    }

    function generate_plot(){ //----------------------------------------------------------------------------------generate the user generated plotly
        build_chart_yaxis_display = "";
        if($('#build_chart_yaxis_display:checked').val()){
            build_chart_yaxis_display = build_chart_yaxis;
        }

        //--------------------------------------------------------------------------------------User Generated Plot
        if(build_chart_type == "bar"){
            var data_user = [{ 
                    x: build_chart_xaxis, 
                    y: build_chart_yaxis, 
                    type: build_chart_type,
                    text: build_chart_yaxis_display,
                    textposition: 'auto',
                    marker: {
                        color: $('#build_chart_bar_fillcolor').val(),
                        opacity: $('#build_chart_bar_opacity').val(),
                        line: {
                            color: $('#build_chart_bar_outlinecolor').val(),
                            width: $('#build_chart_bar_outlinewidth').val()
                        }
                    }
                    }];

            var layout_user = {
                title: $('#build_chart_title_text').val(),
                titlefont: {
                    //family: $('#build_chart_title_font').val(),
                    //size: $('#build_chart_title_size').val(),
                    color: $('#build_chart_title_color').val()
                },
                yaxis: {
                    title: $('#build_chart_yaxis_text').val(),
                    titlefont: {
                        size: 12,
                        color: $('#build_chart_yaxis_color').val()},
                        },
                xaxis: {
                    title: $('#build_chart_xaxis_text').val(),
                    titlefont: {
                        size: 12,
                        color: $('#build_chart_xaxis_color').val()},
                        }
            };
        }
        if(build_chart_type == "line"){
            var data_user = [{ 
                    x: build_chart_xaxis, 
                    y: build_chart_yaxis, 
                    mode: build_chart_linemode,
                    type: build_chart_type,
                    text: build_chart_yaxis_display,
                    textposition: 'auto',
                    marker: {
                        color: $('#build_chart_line_marker_color').val(),
                        size: $('#build_chart_line_marker_size').val()
                    },
                    line: {
                        color: $('#build_chart_line_linecolor').val(),
                        width: $('#build_chart_line_linewidth').val()
                    }
                    }];
            var layout_user = {
                title: $('#build_chart_title_text').val(),
                titlefont: {
                    color: $('#build_chart_title_color').val()
                },
                yaxis: {
                    title: $('#build_chart_yaxis_text').val(),
                    titlefont: {
                        size: 12,
                        color: $('#build_chart_yaxis_color').val()},
                        },
                xaxis: {
                    title: $('#build_chart_xaxis_text').val(),
                    titlefont: {
                        size: 12,
                        color: $('#build_chart_xaxis_color').val()},
                        }
            };
        }
        Plotly.newPlot('UserGeneratedPlot', data_user, layout_user); 
        $('#UserGeneratedPlot').show();
    }

</script>
    
  </html>