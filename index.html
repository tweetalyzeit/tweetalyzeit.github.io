<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="The official website for Tweetalyze, by Adam Gincel and Kevin Quigley.">
    <meta name="author" content="Adam Gincel and Kevin Quigley">

    <title>Tweetalyze</title>

    <!-- Bootstrap Core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="css/landing-page.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic,700italic" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <style type="text/css">
    	.verticalCenter {
    		height: 100%;
    		display: inline-block;
    		vertical-align: middle;
    	}
    	.verticalCenterImg {
    		display: inline-block; vertical-align: middle;
    	}
    </style>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script> 
    <script src="http://malsup.github.com/jquery.form.js"></script>

    <!-- Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

</head>

<body>
<br><br><br><br>
    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-fixed-top topnav" role="navigation">
        <div class="container topnav">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <!--
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button> -->
                <h1><a href="http://tweetalyze.com/">Tweetalyze</a></h1>
                <p>Information on demand.</p>
            </div>
            
        </div>
        <!-- /.container -->
    </nav>

    <main>
        <h2>Query Form</h2>
        <p>Enter a Twitter user's handle and a search term, and we'll query Twitter and give you some statistics!</p>
        <form id="tweetForm">
            <label for="pw">Access key: </label>
            <input type="password" name="pw" id="pw" />
            <br />

            <label for="user">Twitter handle: @</label>
            <input type="text" name="user" id="user" value="realDonaldTrump"/>
            <br />

            <label for="replies">Include replies?</label>
            <input type="checkbox" name="replies" id="replies" />
            <br />

            <label for="rts">Include retweets?</label>
            <input type="checkbox" name="rts" id="rts"/>
            <br />

            <label for="search">Count tweets including: </label>
            <input type="text" name="search" id="search"/>
            <br />

            <button type="submit" id="tweetSubmit">Submit</button>
            <br><br>
        </form>

        <label>Display Raw Response Table?</label><input id="ui_RawResponseTable" type = "checkbox" /><br>
        <label>Plot x: username, y: term prevalence?</label><input id="ui_SSTMU" type = "checkbox" /><br>
        <label>Plot x: username, y: 2 term prevalence?</label><input id="ui_SSTMU2" type = "checkbox" /><br>
        <label>Plot x: term, y: prevalence?</label><input id="ui_MSTSU" type = "checkbox" /><br>
        <label>Plot Tweet Frequency?</label><input id="ui_Frequencies" type = "checkbox" /><br>
        <label>Plot Tweet Length?</label><input id="ui_Lengths" type = "checkbox" /><br>
        <label>Generate Word Cloud?</label><input id="ui_WordCloud" type = "checkbox" /><br>
        <label>Minimum number of occurences to appear in Word Cloud: </label> <input id="wordCloudMinSize" type="number" min="1" max="10" value="5" style="width: 35px" />
        <br><br>

        <section id="error"><h1 id="errorDesc"></h1></section>
        <section id="tweetResults">
            <br>
            <h4><span id="userSpan"></span> Recent Tweet Stats</h4>
            <p>Sample size: <span id="sampleSize"></span></p>
            <p>Sample average frequency: <span id="perDay"></span> tweets/day</p>
            <p>Sample average time between tweets: <span id="averageHoursBetween"></span> hours</p>
            <p id="searchHitsLabel">Sample number of tweets including <span id="searchPhrase"></span>: <span id="searchHits"></span></p>
            <p>Time since last tweet: <span id="daysSince"></span> days</p>
            <p>List of times tweeted</p>
            <ul id="timestamps"></ul>

            
        </section>
        <table id="resultsTable">
            <tr style="border: 1px solid gray">
                <td>Timestamp</td>
                <td>Username</td>
                <td>Inc. Replies?</td>
                <td>Inc. RTs?</td>
                <td>Search Term</td>
                <td>Sample Size</td>
                <!--<td>Avg Tweets Per Day</td>-->
                <!-- <td>Avg Hours Between Tweets</td> -->
                <!--<td>Tweets Including Search Term</td>-->
            </tr>
        </table>
        <br><br>
        <label>Time Requested: </label><p id="currentDate"></p>

        <div id="ResponseTable"><!-- Plotly chart will be drawn inside this DIV --></div>
        <br><br>
        <div id="ByUsername_p"><!-- Plotly chart will be drawn inside this DIV --></div>
        <br><br>
        <div id="ByUsername_p2"><!-- Plotly chart will be drawn inside this DIV --></div>
        <br><br>
        <div id="BySearch_p"><!-- Plotly chart will be drawn inside this DIV --></div>
        <br><br>
        <div id="ByFrequency"><!-- Plotly chart will be drawn inside this DIV --></div>
        <br><br>
        <div id="ByLength"><!-- Plotly chart will be drawn inside this DIV --></div>

        <div id="wordCloudDiv">
            <h2>Word Cloud</h2>
            <canvas id="wordCloud" width="1460" height="840" style="width: 65%; height: auto;"></canvas>
            <br />
            <button onclick="openImage()">Create Downloadable Image</button>
            <h3>Word List</h3>
            <table id="wordList">

            </table>
            <br /> <br />
            <img style="width: 95%; height: auto;" id="wordCloudImg" src="" alt="Right click or long-press to save!" />
        </div>
    </main>
    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <ul class="list-inline">
                        <li>
                            <a href="http://tweetalyze.com">Home</a>
                        </li>
                        <li class="footer-menu-divider">&sdot;</li>
                        <li>
                            <a href="https://adamgincel.com">Adam Gincel</a>
                        </li>
                        <li class="footer-menu-divider">&sdot;</li>
                        <li>
                            <a href="http://kevinquigley.net">Kevin Quigley</a>
                        </li>
                    </ul>
                    <p class="copyright text-muted small">Copyright &copy; Tweetalyze 2018. All Rights Reserved</p>
                </div>
            </div>
        </div>
    </footer>

    <script src="wordcloud2.js"></script>

</body>

</html>

<!--Analytics-->

<script>
    var plotly_timestamp = [];
    var plotly_UNs = [];
    var plotly_replies = [];
    var plotly_rts = [];
    var plotly_searchHits = [];
    var plotly_searchTerms = [];
    var plotly_frequencies = [];
    var plotly_samplesize = [];
    var plotly_searchPercent = [];
    var plotly_hoursBetween = [];
    var plotly_tweetLength = [];
    var plotly_uniqueWords = [];

    function openImage() {
        let canvas = document.getElementById("wordCloud");
        let img = document.getElementById("wordCloudImg");
        img.src = canvas.toDataURL("image/png");
        window.scrollTo(0,document.body.scrollHeight);
    }

    $(document).ready(function() {
        $("#tweetForm").ajaxForm({
            //url: 'http://tweetgettimestamps.herokuapp.com/?' + $('#tweetForm').serialize(),
            url: 'http://tweetgettimestamps.herokuapp.com/?pw=' + $('#pw').val() + '&user=' + $('#user').val() + ($('#replies').is(":checked") ? '&replies=1' : '') + ($('#rts').is(":checked") ? '&rts=1' : '') + ($('#search').val() != "" ? "&search=" + $("#search").val() : "" ),
            type: 'get', 
            beforeSend: function() {
                $('#tweetSubmit').attr("disabled",true);
                $('#tweetSubmit').html("Loading");  
                $("#tweetResults").hide();
                $("#error").hide();
               // console.log('http://tweetgettimestamps.herokuapp.com/?pw=' + $('#pw').val() + '&user=' + $('#user').val() + ($('#replies').is(":checked") ? '&replies=1' : '') + ($('#rts').is(":checked") ? '&rts=1' : ''));
               console.log('http://tweetgettimestamps.herokuapp.com/?pw=' + $('#pw').val() + '&user=' + $('#user').val() + ($('#replies').is(":checked") ? '&replies=1' : '') + ($('#rts').is(":checked") ? '&rts=1' : '') + ($('#search').val() != "" ? "&search=" + $("#search").val() : "" ));
                $("#currentDate").html(new Date().toString());
            },
            success: function(responseText, statusText, xhr, $form) {
                console.log(responseText);
                $('#tweetSubmit').attr("disabled",false);
                $('#tweetSubmit').html("Submit");
                                
                let row = "<tr>";
                if (responseText.name){
                    row += "<td>" + Date(Date.now()) + "</td>";
                    row += "<td>" + responseText.name + "</td>";   //$("#userSpan").html("@" + responseText.name);
                    row += "<td>" + $('#replies').is(":checked") + "</td>";
                    row += "<td>" + $('#rts').is(":checked") + "</td>";

                    plotly_timestamp.push(Date(Date.now()));
                    plotly_UNs.push(responseText.name);
                    plotly_replies.push($('#replies').is(":checked"));
                    plotly_rts.push($('#rts').is(":checked"));
                    plotly_searchHits.push(responseText.searchHits);
                    plotly_searchTerms.push($('#search').val());
                    plotly_frequencies.push(responseText.perDay.toFixed(2));
                    plotly_samplesize.push(responseText.sampleSize);
                    plotly_searchPercent.push(((responseText.searchHits / responseText.sampleSize)*100).toFixed(2));
                    plotly_hoursBetween.push((responseText.avgHoursBetween).toFixed(2));
                    plotly_tweetLength.push((responseText.avgTweetLength).toFixed(2));
                    plotly_uniqueWords.push(responseText.uniqueWords);
                }
                else
                    row += "<td>Name Not Found</td>";//$("#userSpan").html("Name Not Found");

                row += "<td>" + $('#search').val() + "</td>";
                console.log($("#search").val());
                
                if (responseText.sampleSize)
                    row += "<td>" + responseText.sampleSize.toString() + "</td>"; //$("#sampleSize").html(responseText.sampleSize);
                else
                    row += "<td>0</td>"; //$("#sampleSize").html("0");

                /*if (responseText.perDay)
                {
                    row += "<td>" + responseText.perDay.toFixed(4).toString() + "</td>"; //$("#perDay").html(responseText.perDay.toFixed(4));
                }
                else 
                    row += "<td>0</td>"; //$("#perDay").html("0");*/

                /*if (responseText.avgHoursBetween)
                    row += "<td>" + responseText.avgHoursBetween.toFixed(4).toString() + "</td>"; //$("#averageHoursBetween").html(responseText.avgHoursBetween.toFixed(4));
                else
                    row += "<td>0</td>"; //$("#averageHoursBetween").html("0");*/

                /*if (responseText.daysSince)
                    $("#daysSince").html(responseText.daysSince.toFixed(4));
                else
                    $("#daysSince").html("0");

                if (responseText.searchHits !== undefined) {
                    $("#searchHits").html(responseText.searchHits);
                    $("#searchPhrase").html($("#search").val());
                    $("#searchHitsLabel").show();
                } else {
                    $("#searchHitsLabel").hide();
                }*/
                /*if (responseText.searchHits) {
                    row += "<td>" + responseText.searchHits.toString() + "</td>";
                } else {
                    row += "<td>0</td>";
                }*/

                row += "</tr>";
                
                /*let timeList = "";
                for (var i = 0; responseText.dates && i < responseText.dates.length; i++) {
                    timeList += "<li>" + responseText.dates[i].substring(0, 10) + " " + responseText.dates[i].substring(11, 19) + "</li>";
                }
                $("#timestamps").html(timeList);*/

                if (responseText.error) {
                    console.log("We found an error");
                    $("#errorDesc").html(responseText.error);
                    if (Array.isArray(responseText.error))
                        $("#errorDesc").html(responseText.error[0].message);
                    $("#error").show();
                } else {
                    //$("#tweetResults").show();
                    document.getElementById("resultsTable").innerHTML = document.getElementById("resultsTable").innerHTML + row;
                }

                //Plotly JS goes here-------------------------------------------------------------------------- PLOTLY begin

                var values = [ //-------------------------------------------------------Raw Response Table
                        plotly_timestamp,
                        plotly_UNs,
                        plotly_replies,
                        plotly_rts,
                        plotly_searchTerms,
                        plotly_samplesize,
                        plotly_frequencies,
                        plotly_hoursBetween,
                        plotly_tweetLength,
                        plotly_uniqueWords,
                        plotly_searchHits]

                    var data = [{
                    type: 'table',
                    header: {
                        values: [["Timestamp"], ["Username"], ["Include Replies?"], ["Include Retweets?"], ["Search Term"],
                                    ["Sample Size"], ["Average Frequency (Tweets/Day)"], ["Average Period Between Tweets (Hours)"], ["Average Tweet Length (Characters)"], ["Unique Words"], ["Tweets Including Search Term"]],
                        align: "center",
                        line: {width: 1, color: 'black'},
                        fill: {color: 'rgb(0, 128, 255)'},
                        font: {family: "Arial", size: 12, color: "white"}
                    },
                    cells: {
                        values: values,
                        align: "center",
                        line: {color: "black", width: 1},
                        font: {family: "Arial", size: 11, color: ["black"]}
                    }
                    }]

                if($('#ui_RawResponseTable:checked').val()){
                    Plotly.plot('ResponseTable', data);}

                var data_p = [{ //-------------------------------Prevalence of Single Term by Multiple Users
                    x: plotly_UNs, 
                    y: plotly_searchPercent, 
                    type: 'bar',
                    text: plotly_searchPercent,
                    textposition: 'auto'
                    }];

                var layout_p = {
                    title: 'Prevalence of "' + $('#search').val() + '" in Tweets',
                    yaxis: {
                        title: '% of Sampled Tweets incl. "' + $('#search').val() + '"',
                        titlefont: {
                            size: 12,
                            color: 'rgb(107, 107, 107)'},
                            },
                    xaxis: {
                        title: 'Twitter Username',
                        titlefont: {
                            size: 12,
                            color: 'rgb(107, 107, 107)'},
                            }
                    };

                if($('#ui_SSTMU:checked').val()){
                    Plotly.newPlot('ByUsername_p', data_p, layout_p);} 

                var arrayLength = plotly_UNs.length; // -----------------testing prevalance of two terms for multiple users
                var plotx = [];
                var y1 = [];
                var y2 = [];
                var name1 = "";
                var name2 = "";
                for (var i = 0; i < arrayLength; i++) {
                    if(i%2==0){
                        y1.push(plotly_searchPercent[i]);
                        name1 = plotly_searchTerms[i];
                        plotx.push(plotly_UNs[i]);
                    }
                    else{
                        y2.push(plotly_searchPercent[i]);
                        name2 = plotly_searchTerms[i];
                    }
                }
                var trace1_p2 = { 
                    x: plotx,
                    y: y1,
                    name: name1,
                    text: y1,
                    textposition: 'auto',
                    type: 'bar'
                    };

                    var trace2_p2 = {
                    x: plotx,
                    y: y2,
                    name: name2,
                    text: y2,
                    textposition: 'auto',
                    type: 'bar'
                    };

                    var data_p2 = [trace1_p2, trace2_p2];

                    var layout_p2 = {barmode: 'group',
                        title: 'Prevalence of Searched Terms in Tweets',
                        yaxis: {
                            title: '% of Sampled Tweets incl. Term',
                            titlefont: {
                                size: 12,
                                color: 'rgb(107, 107, 107)'},
                                },
                        xaxis: {
                            title: 'Twitter Username',
                            titlefont: {
                                size: 12,
                                color: 'rgb(107, 107, 107)'},
                                }
                    };
                if($('#ui_SSTMU2:checked').val()){
                    Plotly.newPlot('ByUsername_p2', data_p2, layout_p2);}

                var data2_p = [{ //-------------------------------Prevalence of Multiple Terms for Single user
                    x: plotly_searchTerms,
                    y: plotly_searchPercent, 
                    type: 'bar',
                    text: plotly_searchPercent,
                    textposition: 'auto'
                    }];

                var layout2_p = {
                    title: 'Prevalence of Searched Terms in Tweets by @' + $('#user').val(),
                    yaxis: {
                        title: '% of Sampled Tweets incl. Term',
                        titlefont: {
                            size: 12,
                            color: 'rgb(107, 107, 107)'},
                            },
                    xaxis: {
                        title: 'Terms',
                        titlefont: {
                            size: 12,
                            color: 'rgb(107, 107, 107)'},
                            }
                    };

                if($('#ui_MSTSU:checked').val()){
                    Plotly.newPlot('BySearch_p', data2_p, layout2_p);} 

                var data3 = [{ //-------------------------------------Frequencies by Username
                    x: plotly_UNs, 
                    y: plotly_frequencies, 
                    type: 'bar',
                    text: plotly_frequencies,
                    textposition: 'auto'
                    }];

                var layout3 = {
                    title: 'Tweet Frequency',
                    yaxis: {
                        title: 'Average Frequency (Tweets/Day)',
                        titlefont: {
                            size: 12,
                            color: 'rgb(107, 107, 107)'},
                            },
                    xaxis: {
                        title: 'Twitter Username',
                        titlefont: {
                            size: 12,
                            color: 'rgb(107, 107, 107)'},
                            }
                    };

                if($('#ui_Frequencies:checked').val()){
                    Plotly.newPlot('ByFrequency', data3, layout3);} 

                var data4 = [{ //-------------------------------------Average Length by Username
                    x: plotly_UNs, 
                    y: plotly_tweetLength, 
                    type: 'bar',
                    text: plotly_tweetLength,
                    textposition: 'auto'
                    }];

                var layout4 = {
                    title: 'Tweet Length',
                    yaxis: {
                        title: 'Average Tweet Length (Characters)',
                        titlefont: {
                            size: 12,
                            color: 'rgb(107, 107, 107)'},
                            },
                    xaxis: {
                        title: 'Twitter Username',
                        titlefont: {
                            size: 12,
                            color: 'rgb(107, 107, 107)'},
                            }
                    };

                if($('#ui_Lengths:checked').val()){
                    Plotly.newPlot('ByLength', data4, layout4);} //-----------------------------------------------end plotly 

                //---------------------------------------------------------------------------------------------WORD CLOUD BEGIN
                if($('#ui_WordCloud:checked').val()){
                    let wordCloud = [];
                    let minCount = parseInt($("#wordCloudMinSize").val());
                    for (let i = 0; i < responseText.wordCloudList.length; i++) {
                        if (responseText.wordCloudList[i][1] >= minCount)
                            wordCloud.push(responseText.wordCloudList[i]);
                    }

                    let wordList = "<tr><td><strong>Word</strong></td><td><strong>Quantity</strong></td></tr>";
                    wordCloud.sort(function(a, b) {
                        return b[1] - a[1]
                    });
                    let max = parseInt(wordCloud[0][1]);
                    for (let i = 0; i < wordCloud.length; i++) {
                        wordList += "<tr><td>" + wordCloud[i][0] + "</td><td>" + wordCloud[i][1] + "</td></tr>";
                        wordCloud[i][1] = Math.ceil((wordCloud[i][1] * 100) / max);
                    }
                    document.getElementById("wordList").innerHTML = wordList;
                    let canvas = document.getElementById("wordCloud");
                    WordCloud(canvas, {
                        list: wordCloud, 
                        gridSize: 10,
                        weightFactor: function (size) {
                            //return Math.pow(size, 2.3) * $('#wordCloud').width() / 1024;
                            return size * (wordCloud.length > 100 ? 1.4 : 2);
                        },
                        minFontSize: "30px"
                    });              

                    $("#wordCloudDiv").show();} //------------------------------------------------------------------------ end word cloud
            }
        });
        $("#tweetResults").hide();
        $("#error").hide();
        $("#wordCloudDiv").hide();
    });
</script>
    
  </html>